import{a as l,j as e,C as G}from"./index-BM21Z-F7.js";import{b as E,a as f}from"./index.esm-fLsHRhp1.js";import{C as L,a as q}from"./CCardBody-CbQJT8da.js";import{C as z}from"./CCardHeader-aRwIFdF-.js";import{C as H,a as P,b as S,c as h,d as R,e as p}from"./CTable-opFr_he1.js";import{C}from"./CFormSelect-BoNsa119.js";import"./CFormControlWrapper-C9z1l05z.js";import"./CFormControlValidation-Vu2qvpdd.js";import"./CFormLabel-DYMfKWOs.js";const A=["Matemáticas","Física","Química","Biología","Historia"],F=["Ana Pérez","Juan López","Laura Gómez","Carlos Ruiz"],J=["Docente","Supervisor","Auxiliar"],t={salones:[{id:0,nombre:"Sin datos",horarios:[{bloque:"Bloque 1",curso:"",profesor:"",rol:""}]}]},Z=()=>{const[d,m]=l.useState(!1),[b,o]=l.useState(t),[w,c]=l.useState(!0),[j,g]=l.useState(!1),[v,i]=l.useState(null);l.useEffect(()=>{async function s(){c(!0),i(null);try{const a=await fetch("/api/disponibilidad");if(!a.ok)throw new Error("Error al cargar datos");const n=await a.json();!n||!n.salones||n.salones.length===0?o(t):o(n)}catch{o(t)}finally{c(!1)}}s()},[]);const x=(s,a,n,r)=>{o(B=>({salones:B.salones.map(u=>{if(u.id===s){const D=u.horarios.map((y,k)=>k===a?{...y,[n]:r}:y);return{...u,horarios:D}}return u})}))},N=async()=>{g(!0),i(null);try{if(!(await fetch("/api/disponibilidad",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)})).ok)throw new Error("Error al guardar datos");alert("Datos guardados correctamente"),m(!1)}catch(s){i(s.message)}finally{g(!1)}},T=()=>{m(!1),i(null),c(!0),fetch("/api/disponibilidad").then(s=>{if(!s.ok)throw new Error("Error al recargar datos");return s.json()}).then(s=>{!s||!s.salones||s.salones.length===0?(o(t),i("No se encontraron datos, mostrando vacío")):o(s)}).catch(s=>{o(t),i("No se pudo recargar, mostrando vacío")}).finally(()=>c(!1))};return w?e.jsx(E,{className:"py-4 d-flex justify-content-center",children:e.jsx(G,{})}):e.jsxs(E,{className:"py-4",children:[v&&e.jsx("p",{className:"text-warning",style:{marginBottom:"1rem"},children:v}),e.jsxs(L,{children:[e.jsxs(z,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h3",{children:"Disponibilidad de Espacios y Asignaciones"}),d?e.jsxs(e.Fragment,{children:[e.jsx(f,{color:"success",onClick:N,disabled:j,className:"me-2",children:j?"Guardando...":"Guardar"}),e.jsx(f,{color:"secondary",onClick:T,disabled:j,children:"Cancelar"})]}):e.jsx(f,{color:"primary",onClick:()=>m(!0),children:"Editar"})]}),e.jsx(q,{children:b.salones.map(s=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:s.nombre}),e.jsxs(H,{bordered:!0,hover:!0,responsive:!0,children:[e.jsx(P,{children:e.jsxs(S,{children:[e.jsx(h,{children:"Bloque"}),e.jsx(h,{children:"Curso"}),e.jsx(h,{children:"Profesor"}),e.jsx(h,{children:"Rol de Supervisión"})]})}),e.jsx(R,{children:s.horarios.map((a,n)=>e.jsxs(S,{children:[e.jsx(p,{children:a.bloque}),e.jsx(p,{children:d?e.jsxs(C,{value:a.curso||"",onChange:r=>x(s.id,n,"curso",r.target.value),children:[e.jsx("option",{value:"",children:"Libre"}),A.map(r=>e.jsx("option",{value:r,children:r},r))]}):a.curso||e.jsx("em",{children:"Libre"})}),e.jsx(p,{children:d?e.jsxs(C,{value:a.profesor||"",onChange:r=>x(s.id,n,"profesor",r.target.value),children:[e.jsx("option",{value:"",children:"Sin asignar"}),F.map(r=>e.jsx("option",{value:r,children:r},r))]}):a.profesor||e.jsx("em",{children:"Sin asignar"})}),e.jsx(p,{children:d?e.jsxs(C,{value:a.rol||"",onChange:r=>x(s.id,n,"rol",r.target.value),children:[e.jsx("option",{value:"",children:"Sin asignar"}),J.map(r=>e.jsx("option",{value:r,children:r},r))]}):a.rol||e.jsx("em",{children:"Sin asignar"})})]},n))})]})]},s.id))})]})]})};export{Z as default};
