import{a as c,j as e,C as L}from"./index-DAsbAn0n.js";import{b as q,a as d}from"./index.esm-CPR-GhB5.js";import{C as $,a as P}from"./CCardBody-DDA5SjY-.js";import{C as R}from"./CCardHeader-Cwv67G8Q.js";import{C as M,a as F,b as B,c as m,d as J,e as p}from"./CTable-DTKALyF2.js";import{C as v}from"./CFormSelect-BnBNsnLb.js";import"./CFormControlWrapper-Cxpez3An.js";import"./CFormControlValidation-BSwADoeh.js";import"./CFormLabel-we-oz3Y-.js";const O=["Matemáticas","Física","Química","Biología","Historia"],I=["Ana Pérez","Juan López","Laura Gómez","Carlos Ruiz"],Q=["Docente","Supervisor","Auxiliar"],j={salones:[{id:0,nombre:"Sin datos",horarios:[{bloque:"Bloque 1",curso:"",profesor:"",rol:""}]}]},re=()=>{const[l,b]=c.useState(!1),[u,n]=c.useState(j),[k,x]=c.useState(!0),[f,y]=c.useState(!1),[N,t]=c.useState(null),[V,W]=c.useState(!1);c.useEffect(()=>{async function s(){x(!0),t(null);try{const r=await fetch("http://localhost:3001/api/disponibilidad");if(!r.ok)throw new Error("Error al cargar datos");const a=await r.json();!a||!a.salones||a.salones.length===0?n(j):n(a)}catch{n(j),t("Error cargando datos, mostrando vacío")}finally{x(!1)}}s()},[]);const g=(s,r,a,o)=>{n(i=>({salones:i.salones.map(h=>{if(h.id===s){const C=h.horarios.map((w,H)=>H===r?{...w,[a]:o}:w);return{...h,horarios:C}}return h})}))},A=async()=>{y(!0),t(null);try{if(!(await fetch("http://localhost:3001/api/disponibilidad",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).ok)throw new Error("Error al guardar datos");alert("Datos guardados correctamente"),b(!1)}catch(s){t(s.message)}finally{y(!1)}},z=()=>{b(!1),t(null),x(!0),fetch("http://localhost:3001/api/disponibilidad").then(s=>{if(!s.ok)throw new Error("Error al recargar datos");return s.json()}).then(s=>{!s||!s.salones||s.salones.length===0?(n(j),t("No se encontraron datos, mostrando vacío")):n(s)}).catch(()=>{n(j),t("No se pudo recargar, mostrando vacío")}).finally(()=>x(!1))},D=s=>{n(r=>({salones:r.salones.map(o=>o.id===s?{...o,horarios:[...o.horarios,{bloque:`Bloque ${o.horarios.length+1}`,curso:"",profesor:"",rol:""}]}:o)}))},T=(s,r)=>{n(a=>({salones:a.salones.map(i=>{if(i.id===s){const E=i.horarios.filter((h,C)=>C!==r);return{...i,horarios:E}}return i})}))};if(k)return e.jsx(q,{className:"py-4 d-flex justify-content-center",children:e.jsx(L,{})});const G=()=>{const s=u.salones.length>0?Math.max(...u.salones.map(a=>a.id))+1:1,r={id:s,nombre:`Nuevo salón ${s}`,horarios:[{bloque:"Bloque 1",curso:"",profesor:"",rol:""}]};n(a=>({salones:[...a.salones,r]}))},S=u.salones.filter(s=>s.horarios.every(r=>!r.curso&&!r.profesor&&!r.rol)).slice(0,3);return e.jsxs(q,{className:"py-4",children:[N&&e.jsx("p",{className:"text-warning",style:{marginBottom:"1rem"},children:N}),e.jsxs($,{children:[S.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:"Salones disponibles (sin asignaciones)"}),e.jsx("ul",{children:S.map(s=>e.jsx("li",{children:s.nombre},s.id))})]}),e.jsxs(R,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h3",{children:"Disponibilidad de Espacios y Asignaciones"}),l?e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsx(d,{color:"success",onClick:A,disabled:f,children:f?"Guardando...":"Guardar"}),e.jsx(d,{color:"secondary",onClick:z,disabled:f,children:"Cancelar"}),e.jsx(d,{color:"info",onClick:G,disabled:f,children:"+ Nuevo salón"})]}):e.jsx(d,{color:"primary",onClick:()=>b(!0),children:"Editar"})]}),e.jsx(P,{children:u.salones.map(s=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[l?e.jsx("input",{type:"text",className:"form-control me-3",style:{maxWidth:"300px"},value:s.nombre,onChange:r=>n(a=>({salones:a.salones.map(i=>i.id===s.id?{...i,nombre:r.target.value}:i)})),placeholder:"Nombre del salón"}):e.jsx("h5",{className:"mb-0",children:s.nombre}),l&&e.jsx(d,{size:"sm",color:"info",onClick:()=>D(s.id),children:"Agregar bloque"})]}),e.jsxs(M,{bordered:!0,hover:!0,responsive:!0,children:[e.jsx(F,{children:e.jsxs(B,{children:[e.jsx(m,{children:"Bloque"}),e.jsx(m,{children:"Curso"}),e.jsx(m,{children:"Profesor"}),e.jsx(m,{children:"Rol de Supervisión"}),l&&e.jsx(m,{children:"Acciones"})]})}),e.jsx(J,{children:s.horarios.map((r,a)=>e.jsxs(B,{children:[e.jsx(p,{children:r.bloque}),e.jsx(p,{children:l?e.jsxs(v,{value:r.curso||"",onChange:o=>g(s.id,a,"curso",o.target.value),children:[e.jsx("option",{value:"",children:"Libre"}),O.map(o=>e.jsx("option",{value:o,children:o},o))]}):r.curso||e.jsx("em",{children:"Libre"})}),e.jsx(p,{children:l?e.jsxs(v,{value:r.profesor||"",onChange:o=>g(s.id,a,"profesor",o.target.value),children:[e.jsx("option",{value:"",children:"Sin asignar"}),I.map(o=>e.jsx("option",{value:o,children:o},o))]}):r.profesor||e.jsx("em",{children:"Sin asignar"})}),e.jsx(p,{children:l?e.jsxs(v,{value:r.rol||"",onChange:o=>g(s.id,a,"rol",o.target.value),children:[e.jsx("option",{value:"",children:"Sin asignar"}),Q.map(o=>e.jsx("option",{value:o,children:o},o))]}):r.rol||e.jsx("em",{children:"Sin asignar"})}),l&&e.jsx(p,{children:e.jsx(d,{size:"sm",color:"danger",onClick:()=>T(s.id,a),children:"🗑️"})})]},a))})]})]},s.id))})]})]})};export{re as default};
